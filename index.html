<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Earnings Tables</title>
  <style>
    :root{ --bg:#000; --fg:#fff; --accent:#06f; --muted: #bbb; }
    body{ background:var(--bg); color:var(--fg); font-family: system-ui, Arial, sans-serif; margin:20px; text-align:center; }
    .container{ max-width:960px; margin:0 auto; padding:12px; }
    table{ width:100%; border-collapse:collapse; margin:12px auto; text-align:center; }
    th, td{ padding:10px 8px; border:1px solid #333; }
    caption{ caption-side:top; font-weight:600; margin-bottom:8px; }
    .lang-switch{ margin:0 6px; padding:8px 12px; border-radius:8px; border:1px solid #444; background:transparent; cursor:pointer; }
    .lang-switch.active{ background:rgba(255,255,255,0.08); box-shadow:0 2px 6px rgba(0,0,0,0.6); }
    [dir="rtl"] table{ direction:rtl; }
    a.smart-link{ display:inline-block; margin-top:8px; padding:10px 14px; text-decoration:none; border-radius:8px; border:1px solid #444; }
    @media (max-width:600px){ th, td{ font-size:14px; padding:8px; } }

    /* visually-hidden (available to screen readers but hidden visually) */
    .sr-only {
      position: absolute !important;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0 0 0 0);
      white-space: nowrap; border: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="earnings-title"></h2>

    <table id="earnings-table" aria-describedby="table-desc"></table>
    <div id="table-desc" class="sr-only">Table of user earnings per country</div>

    <h3 id="link-title"></h3>
    <p id="link-desc"></p>
    <!-- ضع رابطك الذكي في SMART_LINK داخل السكربت أدناه -->
    <a id="smart-link" class="smart-link" href="#" target="_blank" rel="noopener noreferrer"></a>

    <div style="margin-top:20px; text-align:center;">
      <button class="lang-switch" data-lang="en" aria-pressed="false">English</button>
      <button class="lang-switch" data-lang="ar" aria-pressed="false">العربية</button>
      <button class="lang-switch" data-lang="es" aria-pressed="false">Español</button>
    </div>
  </div>

<script>
  // === البيانات وإعداد الرابط الذكي ===
  const SMART_LINK = "#"; // استبدل "#" بالرابط الذكي الفعلي لديك
  const earningsData = [
    {en: 'US', ar: 'الولايات المتحدة', es: 'EE.UU.', revenue: 26.90, clicks: 1200},
    {en: 'CA', ar: 'كندا', es: 'Canadá', revenue: 22.22, clicks: 850},
    {en: 'CL', ar: 'تشيلي', es: 'Chile', revenue: 10.61, clicks: 430},
    {en: 'AU', ar: 'أستراليا', es: 'Australia', revenue: 9.88, clicks: 400},
    {en: 'IE', ar: 'أيرلندا', es: 'Irlanda', revenue: 9.48, clicks: 320},
  ];

  const translations = {
    en: {
      earningsTitle: "User Earnings per Country",
      countryCol: "Country",
      clicksCol: "Clicks",
      earningsCol: "User Earnings ($)",
      linkMain: "Smart Link",
      linkDesc: "Smart Link (Works for All Countries)",
      clickText: "👉 Click Here 👈"
    },
    ar: {
      earningsTitle: "أرباح المستخدم لكل دولة",
      countryCol: "الدولة",
      clicksCol: "مرات النقر",
      earningsCol: "أرباح المستخدم ($)",
      linkMain: "الرابط الذكي",
      linkDesc: "الرابط الذكي (يعمل لكل الدول)",
      clickText: "👉 اضغط هنا 👈"
    },
    es: {
      earningsTitle: "Ganancias del usuario por país",
      countryCol: "País",
      clicksCol: "Clics",
      earningsCol: "Ganancias ($)",
      linkMain: "Enlace inteligente",
      linkDesc: "Enlace inteligente (Funciona para todos los países)",
      clickText: "👉 Haz clic aquí 👈"
    }
  };

  // Formatters (locale-specific)
  const numberFormats = {
    en: new Intl.NumberFormat('en-US'),
    ar: new Intl.NumberFormat('ar-EG'),
    es: new Intl.NumberFormat('es-ES')
  };
  const currencyFormats = {
    en: new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }),
    ar: new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }),
    es: new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })
  };

  function escapeHtml(text) {
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function renderTable(lang='en') {
    // set language and direction on the <html> element for accessibility
    document.documentElement.lang = (lang === 'ar') ? 'ar' : (lang === 'es' ? 'es' : 'en');
    document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';

    // update headings and link (use textContent to avoid HTML injection)
    document.getElementById('earnings-title').textContent = translations[lang].earningsTitle;
    document.getElementById('link-title').textContent = translations[lang].linkMain;
    document.getElementById('link-desc').textContent = translations[lang].linkDesc;
    const smartLink = document.getElementById('smart-link');
    smartLink.textContent = translations[lang].clickText;
    smartLink.href = SMART_LINK;

    const table = document.getElementById('earnings-table');

    // build header + caption
    const thead = `
      <caption>${escapeHtml(translations[lang].earningsTitle)}</caption>
      <thead>
        <tr>
          <th scope="col">${escapeHtml(translations[lang].countryCol)}</th>
          <th scope="col">${escapeHtml(translations[lang].clicksCol)}</th>
          <th scope="col">${escapeHtml(translations[lang].earningsCol)}</th>
        </tr>
      </thead>
    `;

    // sort by revenue desc
    const sorted = earningsData.slice().sort((a,b) => b.revenue - a.revenue);

    const rows = sorted.map(item => {
      const countryName = (lang === 'ar') ? item.ar : (lang === 'es' ? item.es : item.en);
      return `<tr>
                <td>${escapeHtml(countryName)}</td>
                <td>${numberFormats[lang].format(item.clicks)}</td>
                <td>${currencyFormats[lang].format(item.revenue)}</td>
              </tr>`;
    }).join('');

    table.innerHTML = thead + '<tbody>' + rows + '</tbody>';
  }

  function setLang(lang) {
    renderTable(lang);
    document.querySelectorAll('.lang-switch').forEach(btn => {
      const btnLang = btn.getAttribute('data-lang');
      const active = btnLang === lang;
      btn.classList.toggle('active', active);
      btn.setAttribute('aria-pressed', active ? 'true' : 'false');
    });
  }

  // attach keyboard-friendly listeners (progressive enhancement)
  document.querySelectorAll('.lang-switch').forEach(btn => {
    btn.addEventListener('click', () => setLang(btn.getAttribute('data-lang')));
    btn.addEventListener('keyup', (e) => {
      // handle Enter or Space (cross-browser)
      const isSpace = e.key === ' ' || e.key === 'Spacebar' || e.code === 'Space';
      if (e.key === 'Enter' || isSpace) {
        e.preventDefault();
        btn.click();
      }
    });
  });

  // initial render
  setLang('en');

  // Optional: track clicks on smart link (in-memory only)
  document.getElementById('smart-link').addEventListener('click', (e) => {
    // Increase clicks for the country with the highest revenue (more robust than using index 0)
    let topIndex = 0;
    for (let i = 1; i < earningsData.length; i++) {
      if (earningsData[i].revenue > earningsData[topIndex].revenue) topIndex = i;
    }
    earningsData[topIndex].clicks = (earningsData[topIndex].clicks || 0) + 1;

    // Re-render in the currently selected language
    const currentLang = document.documentElement.lang || 'en';
    renderTable(currentLang);

    // Note: the click will still open the target in a new tab/window because of target="_blank".
    // If you'd like to prevent navigation and handle it via JS, call e.preventDefault() here.
    // To persist clicks across sessions, consider storing `earningsData` in localStorage (optional).
  });
</script>
</body>
</html>
